@page "/exercises"
@using FitnessPT.Components.Controllers
@using FitnessPT.Components.Modals
@inject ExerciseController Controller
@rendermode InteractiveServer

<PageTitle>ìš´ë™ ê´€ë¦¬ - FitnessPT</PageTitle>

<div class="exercises-container">
    <div class="page-header">
        <h3>ìš´ë™ ê´€ë¦¬</h3>
        <button class="btn btn-primary" @onclick="OpenCreateModal">
            ìƒˆ ìš´ë™ ì¶”ê°€
        </button>
    </div>

    <!--í•„í„° -->
    <div class="search-section">
        <div class="filters">
            <select class="form-select" @bind="selectedLevel" @bind:after="ApplyFilters">
                <option value="">ëª¨ë“  ë ˆë²¨</option>
                <option value="beginner">ì´ˆê¸‰</option>
                <option value="intermediate">ì¤‘ê¸‰</option>
                <option value="advanced">ê³ ê¸‰</option>
            </select>

            <select class="form-select" @bind="selectedCategory" @bind:after="ApplyFilters">
                <option value="">ëª¨ë“  ì¹´í…Œê³ ë¦¬</option>
                <option value="upper_body">ìƒì²´</option>
                <option value="lower_body">í•˜ì²´</option>
                <option value="core">ì½”ì–´</option>
                <option value="cardio">ìœ ì‚°ì†Œ</option>
                <option value="full_body">ì „ì‹ </option>
            </select>

            @if (!string.IsNullOrEmpty(selectedLevel) || !string.IsNullOrEmpty(selectedCategory))
            {
                <button class="btn btn-secondary" @onclick="ClearFilters">
                    âœ– ì´ˆê¸°í™”
                </button>
            }
        </div>
    </div>

    <!-- ë¡œë”© -->
    @if (isLoading)
    {
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>ìš´ë™ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
    }
    else if (errorMessage != null)
    {
        <div class="alert alert-danger">
            <strong>ì˜¤ë¥˜:</strong> @errorMessage
            <button class="btn btn-sm btn-secondary" @onclick="LoadExercises">
                ë‹¤ì‹œ ì‹œë„
            </button>
        </div>
    }
    else if (exercises == null || !exercises.Any())
    {
        <div class="empty-state">
            <div class="empty-icon">ğŸ‹ï¸</div>
            <h3>ìš´ë™ì´ ì—†ìŠµë‹ˆë‹¤</h3>
            <p>ìƒˆë¡œìš´ ìš´ë™ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
            <button class="btn btn-primary" @onclick="OpenCreateModal">
                â• ì²« ìš´ë™ ì¶”ê°€í•˜ê¸°
            </button>
        </div>
    }
    else
    {
        <!-- ìš´ë™ ì¹´ë“œ ê·¸ë¦¬ë“œ -->
        <div class="exercises-grid">
            @foreach (var exercise in exercises)
            {
                <ExerciseCard
                    Exercise="exercise"
                    OnEdit="() => OpenEditModal(exercise)"
                    OnDelete="() => DeleteExercise(exercise.Id)" />
            }
        </div>

        <!-- í˜ì´ì§• -->
        @if (totalPages > 1)
        {
            <div class="pagination">
                <button class="btn btn-page"
                        disabled="@(currentPage == 1)"
                        @onclick="() => ChangePage(currentPage - 1)">
                    â† ì´ì „
                </button>

                <span class="page-info">
                    @currentPage / @totalPages í˜ì´ì§€ (ì´ @totalCount ê°œ)
                </span>

                <button class="btn btn-page"
                        disabled="@(currentPage == totalPages)"
                        @onclick="() => ChangePage(currentPage + 1)">
                    ë‹¤ìŒ â†’
                </button>
            </div>
        }
    }

    <!-- ê´€ë¦¬ì ì¸ì¦ ëª¨ë‹¬ -->
    <PasswordModal
        OnAuthenticated="OpenAuthModal"
        IsActive="activeAuthModal"
        IsActiveChanged="(value) => activeAuthModal = value"/>

    <!-- ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
    <ExerciseModal
        Exercise="selectedExercise"
        IsActive="activeEditModal"
        IsEdit="isEditMode"
        OnSave="SaveExercise"
        IsActiveChanged="(value) => activeEditModal = value"/>

</div>